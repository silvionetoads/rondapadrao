<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rondas do Vigilante v.001</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f9; }
    h1 { text-align: center; }
    .container { max-width: 700px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, textarea, select { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; }
    button { margin: 5px 5px 5px 0; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; }
    #timer { font-size: 2em; text-align: center; margin: 20px 0; }
    .history { margin-top: 20px; }
    .record { border-bottom: 1px solid #ddd; padding: 10px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Rondas do Vigilante</h1>

    <label for="restTime">Tempo de descanso (minutos):</label>
    <input type="number" id="restTime" min="1" placeholder="Informe minutos">
    <div id="timer">00:00</div>

    <button id="startRest">Iniciar Descanso</button>
    <button id="stopRest">Parar</button>
    <button id="resetRest">Reset</button>

    <label for="vigilante">Nome do Vigilante:</label>
    <input type="text" id="vigilante">

    <label for="posto">Nome do Posto:</label>
    <input type="text" id="posto">

    <label for="obs">Observações:</label>
    <textarea id="obs"></textarea>

    <button id="startRonda">Iniciar Ronda</button>
    <button id="endRonda">Finalizar Ronda</button>
    <button id="save">Salvar Informações</button>

    <div class="history">
      <h3>Histórico</h3>
      <div id="records"></div>
    </div>

    <button id="printReport">Imprimir Relatório</button>
    <button id="exportJSON">Exportar JSON</button>
    <button id="clearHistory">Limpar Histórico</button>
  </div>

  <script>
    let timerInterval;
    let restSeconds = 0;
    let rondaInicio = null;

    function updateTimerDisplay() {
      let m = String(Math.floor(restSeconds / 60)).padStart(2, '0');
      let s = String(restSeconds % 60).padStart(2, '0');
      document.getElementById('timer').textContent = `${m}:${s}`;
    }

    document.getElementById('startRest').onclick = () => {
      const minutes = parseInt(document.getElementById('restTime').value);
      if (!minutes) return alert('Informe o tempo de descanso!');
      restSeconds = minutes * 60;
      updateTimerDisplay();
      timerInterval = setInterval(() => {
        if (restSeconds > 0) {
          restSeconds--;
          updateTimerDisplay();
        } else {
          clearInterval(timerInterval);
          alert('Tempo de descanso finalizado!');
        }
      }, 1000);
    };

    document.getElementById('stopRest').onclick = () => clearInterval(timerInterval);
    document.getElementById('resetRest').onclick = () => { clearInterval(timerInterval); restSeconds = 0; updateTimerDisplay(); };

    document.getElementById('startRonda').onclick = () => { rondaInicio = new Date().toLocaleString(); alert('Ronda iniciada.'); };
    document.getElementById('endRonda').onclick = () => alert('Ronda finalizada.');

    document.getElementById('save').onclick = () => {
      const vigilante = document.getElementById('vigilante').value;
      const posto = document.getElementById('posto').value;
      const obs = document.getElementById('obs').value;
      const rondaFim = new Date().toLocaleString();

      const record = { data: new Date().toLocaleString(), vigilante, posto, obs, inicio: rondaInicio, fim: rondaFim, descanso: document.getElementById('restTime').value };

      let records = JSON.parse(sessionStorage.getItem('records') || '[]');
      records.push(record);
      sessionStorage.setItem('records', JSON.stringify(records));

      renderRecords();
    };

    function renderRecords() {
      const records = JSON.parse(sessionStorage.getItem('records') || '[]');
      const container = document.getElementById('records');
      container.innerHTML = '';
      records.forEach((r, i) => {
        container.innerHTML += `<div class="record">${i+1}. [${r.data}] Vigilante: ${r.vigilante}, Posto: ${r.posto}, Início: ${r.inicio}, Fim: ${r.fim}, Descanso: ${r.descanso} min, Obs: ${r.obs}</div>`;
      });
    }

    document.getElementById('printReport').onclick = () => {
      const records = JSON.parse(sessionStorage.getItem('records') || '[]');
      let content = '<h1>Relatório de Rondas</h1>';
      records.forEach((r, i) => {
        content += `<p>${i+1}. [${r.data}] Vigilante: ${r.vigilante}, Posto: ${r.posto}, Início: ${r.inicio}, Fim: ${r.fim}, Descanso: ${r.descanso} min, Obs: ${r.obs}</p>`;
      });
      const win = window.open('', '', 'width=800,height=600');
      win.document.write(content);
      win.print();
    };

    document.getElementById('exportJSON').onclick = () => {
      const records = sessionStorage.getItem('records');
      const blob = new Blob([records], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'rondas.json';
      a.click();
      URL.revokeObjectURL(url);
    };

    document.getElementById('clearHistory').onclick = () => { sessionStorage.removeItem('records'); renderRecords(); };

    renderRecords();
  </script>
</body>
</html>
